---
tags: ["课程","Games101","图形学"]
date: 2023-09-27
title: 07 着色（光照与基本着色模型） 
password: 211511011
message: 此文章转载请与作者处观看https://www.yuque.com/gaoshanliushui-mbfny
---
# 着色之前

![](/images/posts/1694776433532-088fe65d-1c55-4586-a51c-ed607b4c31c6.png)

模型变换 ——视图变换——投影变换——视口变换——光栅化

把这些三角形画在屏幕上后，这些像素的颜色是什么呢？这就是着色的工作。

# 着色

## 定义

着色的定义：物体应用材质的过程

我们为什么能看到物体：人眼接收到了物体来的光。

![](/images/posts/1694776433894-b1a8a5df-0e29-4d51-bc5f-1169a8ce83c2.png)

- 高光
- 漫反射
- 环境光照

## Shading point

一些规定
![](/images/posts/1694776433567-18f720b9-67d6-4afd-b628-987d6d85418f.png)

- 观测方向$\hat{v}$
- 法线$\hat{n}$
- 光照方向$\hat{l}$
- 表面参数(颜色，shininess)

**着色局部性**：只考虑这个点，不考虑其他物体的存在（不考虑阴影）。

## 泛光反射

泛光反射即环境光，这里做出假设：任何一个点接受环境光相同。
可以得到理想经验模型：
![](/images/posts/1694776433397-67100f8b-e515-42d4-b714-56f6ba814716.png)
其中$k_{a}$表示表面对环境光的反射率，$I_{a}$表示入射环境光的亮度。
这个式子和$\hat{l},\hat{n},\hat{v}$都没关系，可以证实这个理想模型$L_{a}$是常数即一个颜色。

经过泛光反射效果如下：
![](/images/posts/1694776433325-33140075-4632-4d2b-8690-f74e9e346c71.png)

## Lambert漫反射模型

漫反射使物体有体积感。

漫反射是光从一定角度入射之后从入射点向四面八方反射，且每个不同方向反射的光的强度相等。
产生漫反射的原因是物体表面的粗糙，导致了这种物理现象的发生。
![](/images/posts/1694776433999-85c7b342-4524-4297-b4c8-dda5b4d26eb8.png)

两个理论：

- Lambert余弦定理：$\hat{l}$和$\hat{n}$夹角决定光照强度，应该将光强乘上$cos\theta = l*n$。
  ![](/images/posts/1694776434159-796b8858-b150-4059-a889-4cc0e39ef83f.png)
- 能量衰退定理：点光源，半径越大，能量越小。应该将光强除上$r^{2}$(r为光源到入射点距离)
  ![](/images/posts/1694776434786-8d890b13-6753-47bc-88fc-f99499271f22.png)

根据这两个理论，可以得到Lambert漫反射模型：
![](/images/posts/1694776435000-a1536d0a-8c29-4c78-bcd9-e993e00b5d02.png)
其中$k_{d}$为漫反射系数，修改$k_{d}$可以得到物体表面不同的颜色，$I$为入射光强，$r$为光源到入射点距离，$n,l$分别是法向量和入射方向，$max$是为了剔除夹角大于90°的光（负数）。
漫反射系数$k_{d}$：表示为一个vector→RGB三通道→定义一个颜色
观察这个式子，其中没有出现$\hat{v}$，也证实了**漫反射与观察方向无关**。
Lambert漫反射模型只是一个经验模型，与实际物理有差异。

经过漫反射效果如下：
![](/images/posts/1694776434934-fba0dbab-78a3-443f-84ab-f5ba321e3432.png)

## 高光

### Phong反射模型

![](/images/posts/1694776436340-f8abe673-0b83-4eb5-8545-6c31779294ab.png)
其中$\hat{R}$为镜面反射方向。

产生高光的条件：

- 光滑的表面
- 观察方向接近镜面反射方向（$\hat{v}$和$\hat{R}$足够接近才能看到）

如何判断$\hat{v}$和$\hat{R}$的距离：$cos\alpha=\hat{v}\cdot\hat{R}$

于是得到Phong反射模型：
$L_{s} = k_{s}(I/r^{2})max(0,cos\alpha)^{p} = k_{s}(I/r^{2})max(0,cos(\hat{v}\cdot\hat{R}))^{p}$

其中$k_{s}$为镜面反射系数，经验模型简化忽略能量损失，$I$为入射光强，$r$为光源到入射点距离，$max$用来提出大于90°的光（负数）。

- 指数p的原因：防止反射光过大，离反射光越远就越不应该看见反射光，需要一个指数p加速衰减，如下图所示
- 指数p的作用：控制高光的大小，一般用100~200
  ![](/images/posts/1694776437642-45c2edad-abe3-4da5-843f-7c63ac017453.png)
  ![](/images/posts/1694776438013-4ca2bd2e-ba99-4ff0-8fee-c57575333860.png)

经过Phong模型后效果如下：
![](/images/posts/1694776437899-419c0197-7dfb-4412-8331-64eee6bc580c.png)

然而，Phong模型有一个缺点：不方便计算$cos(\hat{v}\cdot\hat{R})$的值，于是有了Blinn-Phong反射模型。

### Blinn-Phong反射模型

![](/images/posts/1694776438517-682cc0d2-5b6c-4841-a584-2a011f4ac373.png)
核心思想：引入半程向量$\hat{n}$，即当观察方向$\hat{v}$和镜面反射方向$\hat{R}$接近时，认为半程向量$\hat{h}$与法线方向$\hat{n}$接近。
其中
$\begin{aligned}
\hat{h}&=bisector(\hat{v},\hat{l})\\
&=\frac{\hat{v}+\hat{l}}{||\hat{v}+\hat{l}||}
\end{aligned}$

于是得到Blinn-Phong反射模型：
$L_{s}=k_{s}(l/r^{2})max(0, \hat{n}\cdot \hat{h})^{p}$

## Blinn-Phong整体计算公式

最终，得到着色整体计算公式。
![[Pasted image 20230916104047.png]]